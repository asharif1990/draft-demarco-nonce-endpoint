---
title: "OAuth 2.0 Nonce Endpoint"
abbrev: "Nonce Endpoint"
category: info

docname: draft-demarco-nonce-endpoint-latest
submissiontype: IETF  # also: "independent", "editorial", "IAB", or "IRTF"
number:
date:
consensus: true
v: 3
# area: "Security"
# workgroup: OAuth 2.0 Working Group
keyword:
 - OAuth 2.0
venue:
#  group: WG
#  type: Working Group
#  mail: demarcog83@gmail.com
  github: "peppelinux/draft-demarco-nonce-endpoint"
  latest: "https://peppelinux.github.io/draft-demarco-nonce-endpoint/draft-demarco-nonce-endpoint.html"

author:
 -
    fullname: Giuseppe De Marco
    organization: Independent
    email: demarcog83@gmail.com

normative:
  RFC2119: RFC2119
  RFC5246: RFC5246
  RFC6749: RFC6749
  RFC7159: RFC7159
  RFC7519: RFC7519

informative:
  BCP195: BCP195

--- abstract

This document defines the nonce endpoint for OAuth 2.0 implementations [RFC6749].
The nonce endpoint allows a client to request and obtain server-generated opaque nonces from a server, such as an OAuth 2.0 Authorization Server.

--- middle

# Introduction

This specification defines a method for a client to request and obtain a new nonce from a server. The nonce is an arbitrary and randomic string used to protect a communication against replay attacks.


OAuth 2.0 deployments using this endpoint uses cryptographic mechanisms for the issuance of the nonces, providing confidentiality of the information carried within them. These information can be of different nature and designed to satisfy different implementation needs, such as the origin of the nonce, the time of issuance, the time of expiration and its audiences. An encrypted nonce value is used in infrastructures that do not use shared storages between multiple nodes to retain and share, within their domain, the nonces previously issued.

# Conventions and Definitions

{::boilerplate bcp14-tagged}

# Terminology

Nonce:
:  A random or pseudo-random number that is generated for a specific use, typically for cryptographic communication. The Nonce is used to protect against replay attacks by ensuring that a message or data cannot be reused or retransmitted, maliciously or otherwise. The term "nonce" stands for "number used once" and it MUST be unique within some scope.

Nonce Issuer:
:  The entity that generates and provides the Nonce. In the context of OAuth 2.0, the Nonce Issuer would typically be the Authorization Server.

Nonce Endpoint:
:  The HTTP endpoint provided by the Nonce Issuer for the issuance of new Nonces.

# Requirements

The Nonce Endpoint is an HTTP endpoint designed to generate new Nonces. This endpoint MUST satisfy the following requirements:

- It is mandatory for this endpoint to be secured by TLS [RFC5246];
- It generates a new Nonce in response to each request, such that under no circumstances can two identical nonces be generated by the Nonce Issuer in response to two different requests, whether these occur simultaneously or at different times.

The Nonce MUST satisfy the following requirements:

- The Nonces MUST be purely opaque to the Clients that receive these;
- The Nonce values MUST be encrypted with an encryption key that:
  - MUST NOT be provided by the Nonce Issuer to the Client;
  - MUST NOT be provided by the Nonce Issuer to any other entity outside the domain where the Nonce Issuer belongs;
- No entity other than its Nonce Issuer, and the servers within the Nonce Issuer's domain, can know the decrypted contents of the Nonce or can be able to decrypt its content.

# Nonce Request

When a Client needs a Nonce, it sends an HTTP GET request to the server's Nonce Endpoint. In response, the Nonce Issuer provides a Nonce to the Client, encapsulated within a JSON object [RFC7159].

Below is a non normative example of the HTTP Request made by a Client to the Nonce Endpoint.

~~~~ http
GET /nonce HTTP/1.1
Host: server.example.com
~~~~

# Nonce Response

The response MUST use the HTTP Header Content-Type value set to `application/json` and MUST contain a JSON object where the member `nonce` is present. 

Below is a non-normative example of the response given by a Nonce Issuer:

~~~~ http
HTTP/1.1 200 OK
Content-Type: application/json

{
  "nonce": "d2JhY2NhbG91cmVqdWFuZGFt"
}
~~~~

The Nonce value MUST be completely opaque to the Client, in a way that the data contained in it MUST NOT be disclosed.

# Nonce Endpoint Discovery

When a server requires the use of a Nonce in the request for a specific resource and the Client doesn't provide it in its request,
the server MUST return an HTTP response with the  HTTP status code `400` and an `error` field with the value set to `"nonce_required"`.

This HTTP response MUST contain the `Nonce-Endpoint-URI` HTTP header with the value set to the URL corresponding to the Nonce Endpoint, where the Client can request and fetch a new Nonce from the Nonce Issuer.

The Client SHOULD use the HTTPs URL provided in the `Nonce-Endpoint-URI` HTTP header to request a new Nonce before renewing the request where to include the Nonce provided by the Nonce Issuer.

Below is a non-normative example of an error response issued by a server that requires the Nonce in the Client request, the response informs the Client about the Nonce Endpoint where a new Nonce can be requested:

~~~~ http
HTTP/1.1 400 Bad Request
Nonce-Endpoint-URI: http://server.example.org/nonce-endpoint

{
  "error": "nonce_required",
  "error_description":
    "Authorization server requires the nonce in the request"
}
~~~~

In cases where, for some reasons, a correctly issued Nonce can no longer be considered valid by the server that receives it, the server MUST return the generic error `"nonce_required"` reporting the same description as `"error_description"` as if the Nonce had not been received. The cases when an issued Nonce is considered no longer valid by its issuer MAY be caused by the rotation of the encryption keys, its expiration, or other specific conditions internal to an implementation.

# Non-normative Examples

The decrypted Nonce payload may be of different formats and contains any kind of implementation-specific attributes.
Below are provided some non-normative examples, describing how a decrypted and JSON serialized Nonce payload may appear:

~~~~
{
  "iss": "https://issuer.example.com",
  "iat": 1615908701,
  "exp": 1615995101,
  "source_endpoint": "https://service.example.com/nonce-endpoint",
  "aud": "https://service.example.com/endpoint"
}
~~~~

Please note that the values represented in the previous examples may depend on domain specific requirements and implementation and these MUST NOT be intended as normative.

# Security Considerations

The Nonce Endpoint MUST be protected by TLS to prevent eavesdropping and man-in-the-middle attacks, therefore the practices defined in [BCP195] should be followed.

The Nonce Issuer MUST securely generate and store the symmetric key used to encrypt the Nonce. The key MUST NOT be provided to the Client or to any other entities outside of the Nonce Issuer's domain.

The robustness of the encryption key plays a crucial role in the security of the Nonce Endpoint. The following considerations should be taken into account:

1. **Key Strength**: The symmetric key used for encrypting the Nonce should be of sufficient length to resist brute-force attacks. For example, a key length of 256 bits is currently considered to provide a good level of security.

2. **Key Management**: The symmetric key should be securely managed. It should be securely generated, stored, and revoked. Access to the key should be strictly controlled and limited to authorized entities only.

3. **Key Rotation**: Regular key rotation is a good practice to mitigate the risk of key compromise. The frequency of key rotation depends on the specific requirements and threat model, but a common practice is to rotate keys frequently.

4. **Randomness**: The symmetric key, when used, should be generated using a secure random number generator to ensure its randomness. Predictable keys can be easily guessed by attackers.

5. **Secure Transmission**: If the symmetric key needs to be transmitted over a network and within the Nonce Issuer domain, it must be securely transmitted using secure protocols such as TLS.

6. **Backup and Recovery**: Secure backup and recovery procedures should be in place for the cryptographic keys. This is to ensure that the key can be recovered in case of loss, while preventing unauthorized access to the backup.

The security of the Nonce Endpoint is only as strong as the security of the encryption key. Therefore, proper key management practices are essential.

# Considerations about nonce vs. jti

In this section are provided some consideration about the main differences and scopes about the nonce in comparison to the `jti` claim defined in [RFC7519].

TBD.

# IANA Considerations

This document has no IANA actions.

--- back

# Acknowledgments
{:numbered="false"}

TODO acknowledge.
